<div class="grid two-columns">
  <section class="card">
    <h2>Perfil profesional</h2>
    <% if @profile.present? %>
      <p><strong>Nombre:</strong> <%= current_user.name %></p>
      <p><strong>Zona:</strong> <%= @profile.zone %></p>
      <p><strong>Experiencia:</strong> <%= @profile.years_experience %> años</p>
      <% if @profile.day_rate.present? %>
        <p><strong>Tarifa diaria:</strong> <%= number_to_currency(@profile.day_rate) %></p>
      <% end %>
      <p class="muted">Actualizado el <%= l(@profile.updated_at, format: :long) %></p>
    <% else %>
      <p class="muted">Completa tu perfil profesional para recibir trabajos asignados.</p>
    <% end %>
  </section>

  <section class="card">
    <h2>Próximos seguimientos</h2>
    <% if @upcoming_follow_ups.any? %>
      <table>
        <thead>
          <tr>
            <th>Lead</th>
            <th>Estado</th>
            <th>Seguimiento</th>
          </tr>
        </thead>
        <tbody>
          <% @upcoming_follow_ups.each do |lead| %>
            <tr>
              <td><%= lead.name %></td>
              <td><span class="status" data-status="<%= lead.status %>"><%= lead.status.humanize %></span></td>
              <td><%= l(lead.follow_up_at, format: :short) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="muted">No tienes seguimientos programados.</p>
    <% end %>
  </section>
</div>

<section class="card" style="margin-top: 1.5rem;">
  <h2>Trabajos asignados</h2>
  <% if @bookings.any? %>
    <table>
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Fecha</th>
          <th>Ubicación</th>
          <th>Estado</th>
          <th>Materiales</th>
          <th>Archivos</th>
        </tr>
      </thead>
      <tbody>
        <% @bookings.each do |booking| %>
          <tr>
            <td>
              <strong><%= booking.customer.name %></strong><br />
              <span class="muted"><%= booking.description.truncate(60) %></span>
            </td>
            <td><%= l(booking.date, format: :long) %> (<%= booking.days %> días)</td>
            <td><%= booking.address %></td>
            <td><span class="status" data-status="<%= booking.status %>"><%= booking.status.humanize %></span></td>
            <td>
              <% if booking.material_order.present? %>
                <span class="status" data-status="<%= booking.material_order.status %>">Pedido <%= booking.material_order.status.humanize %></span>
              <% else %>
                <span class="muted">Sin pedido</span>
              <% end %>
            </td>
            <td>
              <% if booking.attachments.any? %>
                <div class="attachments">
                  <% booking.attachments.each_with_index do |url, idx| %>
                    <a href="<%= url %>" target="_blank" rel="noopener">Archivo <%= idx + 1 %></a>
                  <% end %>
                </div>
              <% else %>
                <span class="muted">Sin archivos</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="muted">Todavía no tienes trabajos asignados.</p>
  <% end %>
</section>

<section class="card" style="margin-top: 1.5rem;">
  <h2>Leads activos</h2>
  <% if @leads.any? %>
    <table>
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Contacto</th>
          <th>Estado</th>
          <th>Origen</th>
          <th>Notas</th>
        </tr>
      </thead>
      <tbody>
        <% @leads.each do |lead| %>
          <tr>
            <td><%= lead.name %></td>
            <td>
              <% if lead.email.present? %>
                <div><a href="mailto:<%= lead.email %>"><%= lead.email %></a></div>
              <% end %>
              <% if lead.phone.present? %>
                <div><a href="tel:<%= lead.phone %>"><%= lead.phone %></a></div>
              <% end %>
            </td>
            <td><span class="status" data-status="<%= lead.status %>"><%= lead.status.humanize %></span></td>
            <td><%= lead.source.presence || "—" %></td>
            <td><%= lead.notes.to_s.truncate(80) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="muted">Aún no tienes leads asignados. Activa campañas o solicita leads al equipo comercial.</p>
  <% end %>
</section>
