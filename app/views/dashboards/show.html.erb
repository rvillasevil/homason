<section class="content">
  <div class="dashboard">
    <header class="dashboard-hero">
      <div>
        <p class="eyebrow" style="margin: 0; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-soft);">
          Hub operativo
        </p>
        <h1 style="margin: 0; font-size: clamp(2rem, 4vw, 3rem);">Panel colaborativo Homason</h1>
        <p style="margin: 0; color: var(--text-soft); max-width: 70ch;">
          Centraliza el envÃ­o de presupuestos, la planificaciÃ³n de mano de obra, el calendario profesional y las reservas
          autogestionables del cliente en una sola experiencia fluida.
        </p>
      </div>
      <div class="dashboard-hero__meta">
        <span class="user-pill">SesiÃ³n activa Â· <strong><%= current_user[:name] %></strong></span>
        <span class="chip">Rol: <%= role_label(current_user[:role]) %></span>
        <div class="dashboard-hero__actions">
          <%= link_to "ConfiguraciÃ³n", profile_path, class: "button secondary" %>
          <%= button_to "Cerrar sesiÃ³n", session_path, method: :delete, form: { class: "inline-form" }, class: "button ghost" %>
        </div>
      </div>
    </header>

    <section class="dashboard-metrics">
      <% [
           { label: "Proyectos activos", value: "4", detail: "+1 esta semana", icon: "ðŸ—ï¸", accent: "rgba(59,130,246,.15)" },
           { label: "Presupuestos enviados", value: "12", detail: "3 pendientes", icon: "ðŸ§¾", accent: "rgba(249,115,22,.15)" },
           { label: "Reservas confirmadas", value: "8", detail: "2 requieren ajuste", icon: "ðŸ“…", accent: "rgba(34,197,94,.2)" }
         ].each do |metric| %>
        <article class="dashboard-metric">
          <div
            class="dashboard-metric__icon"
            style="background: <%= metric[:accent] %>; border: 1px solid rgba(17, 24, 39, 0.08);"
          >
            <%= metric[:icon] %>
          </div>
          <p style="margin: 0; color: var(--text-soft); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em;">
            <%= metric[:label] %>
          </p>
          <p class="dashboard-metric__value"><strong><%= metric[:value] %></strong></p>
          <p style="margin: 0; color: var(--accent); font-size: 0.9rem;"> <%= metric[:detail] %></p>
        </article>
      <% end %>
    </section>

    <div class="dashboard-grid-two">
      <section class="card-panel">
        <div class="card-panel__head">
          <div>
            <p class="eyebrow" style="margin: 0;">Administrador</p>
            <h2 style="margin: 0;">Presupuestos y partidas</h2>
          </div>
          <button class="button secondary" style="padding: 0.4rem 1rem;">Ver historial</button>
        </div>
        <div class="quote-form">
          <div style="display: flex; align-items: center; gap: 0.6rem;">
            <div class="user-pill" style="background: rgba(76,92,255,0.12);">Enviar presupuesto</div>
            <small style="color: var(--text-soft);">Comparte alcance y montos personalizados</small>
          </div>
          <form style="display: grid; gap: 0.8rem;">
            <label style="display: grid; gap: 0.3rem;">
              <span style="font-size: 0.85rem; color: var(--text-soft);">Cliente / obra</span>
              <select style="border-radius: 0.9rem; border: 1px solid var(--border); padding: 0.75rem; background: #fff;">
                <option>Residencial Â· Proyecto Rivera</option>
                <option>Retail Â· Local Centro</option>
                <option>Oficinas Â· Torre Sur</option>
              </select>
            </label>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.8rem;">
              <label style="display: grid; gap: 0.3rem;">
                <span style="font-size: 0.85rem; color: var(--text-soft);">Monto estimado</span>
                <input type="number" placeholder="â‚¬ 0" style="border-radius: 0.9rem; border: 1px solid var(--border); padding: 0.75rem;" />
              </label>
              <label style="display: grid; gap: 0.3rem;">
                <span style="font-size: 0.85rem; color: var(--text-soft);">Vigencia</span>
                <input type="date" style="border-radius: 0.9rem; border: 1px solid var(--border); padding: 0.75rem;" />
              </label>
            </div>
            <label style="display: grid; gap: 0.3rem;">
              <span style="font-size: 0.85rem; color: var(--text-soft);">Notas o alcance</span>
              <textarea rows="3" placeholder="Incluye hitos, entregables y vigencia" style="border-radius: 0.9rem; border: 1px solid var(--border); padding: 0.75rem;"></textarea>
            </label>
            <button type="button" class="button primary" style="justify-content: center;">Mandar presupuesto</button>
          </form>
        </div>
        <div class="budget-builder">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 1rem;">Constructor de partidas</h3>
            <span style="color: var(--text-soft); font-size: 0.9rem;">Modo detallado</span>
          </div>
          <div class="budget-builder__items">
            <% [
                 { concept: "Mano de obra Â· dÃ­a completo", cost: "â‚¬ 420", meta: "2 oficiales", tone: "rgba(76,92,255,0.12)" },
                 { concept: "Mano de obra Â· media jornada", cost: "â‚¬ 210", meta: "Pintura y acabados", tone: "rgba(14,165,233,0.15)" },
                 { concept: "Materiales", cost: "â‚¬ 1,850", meta: "Mortero, cableado, luminarias", tone: "rgba(249,115,22,0.1)" },
                 { concept: "Otros", cost: "â‚¬ 380", meta: "Permisos municipales", tone: "rgba(16,185,129,0.15)" }
               ].each do |item| %>
              <div class="budget-item">
                <div class="budget-item__meta">
                  <span class="chip" style="background: <%= item[:tone] %>; color: var(--text); font-size: 0.75rem;">
                    <%= item[:concept] %>
                  </span>
                  <span style="color: var(--text-soft); font-size: 0.9rem;"> <%= item[:meta] %></span>
                </div>
                <strong><%= item[:cost] %></strong>
              </div>
            <% end %>
          </div>
          <button class="button ghost" style="justify-content: center;">Agregar partida</button>
        </div>
      </section>

      <section class="card-panel">
        <div class="card-panel__head">
          <div>
            <p class="eyebrow" style="margin: 0;">Profesional</p>
            <h2 style="margin: 0;">Calendario de obras</h2>
          </div>
          <button class="button secondary" style="padding: 0.4rem 1rem;">Sincronizar</button>
        </div>
        <div class="calendar-grid">
          <% %w[Lun Mar MiÃ© Jue Vie].each_with_index do |day, index| %>
            <% highlight = index == 2 %>
            <div class="calendar-day <%= "calendar-day--highlight" if highlight %>">
              <p style="margin: 0; font-size: 0.85rem; color: var(--text-soft);"><%= day %></p>
              <p style="margin: 0; font-size: 1.4rem; font-weight: 600;">1<%= index %></p>
              <% if highlight %>
                <p style="margin: 0; font-size: 0.85rem; color: var(--accent-strong);">Visita de obra</p>
              <% else %>
                <p style="margin: 0; font-size: 0.85rem; color: var(--text-soft);">Disponible</p>
              <% end %>
            </div>
          <% end %>
        </div>
        <ul class="schedule-list">
          <% [
               { title: "Obra La Rivera", date: "12 JUN", detail: "InstalaciÃ³n elÃ©ctrica Â· 08:00" },
               { title: "Reforma local Centro", date: "13 JUN", detail: "SupervisiÃ³n estructuras Â· 10:00" },
               { title: "Torre Sur", date: "15 JUN", detail: "Cierre frente norte Â· 16:00" }
             ].each do |event| %>
            <li class="schedule-item">
              <div>
                <strong><%= event[:title] %></strong>
                <p style="margin: 0; font-size: 0.85rem; color: var(--text-soft);"><%= event[:detail] %></p>
              </div>
              <span style="font-weight: 600; color: var(--accent);"><%= event[:date] %></span>
            </li>
          <% end %>
        </ul>
      </section>
    </div>

    <section class="card-panel">
      <div class="card-panel__head">
        <div>
          <p class="eyebrow" style="margin: 0;">Cliente</p>
          <h2 style="margin: 0;">Reservas autogestionables</h2>
          <p style="margin: 0; color: var(--text-soft);">CancelaciÃ³n, reprogramaciÃ³n o modificaciÃ³n en un clic.</p>
        </div>
        <button class="button secondary" style="padding: 0.4rem 1rem;">Crear nueva reserva</button>
      </div>
      <div style="overflow-x: auto;">
        <table class="reservations-table">
          <thead>
            <tr>
              <th>Reserva</th>
              <th>Materiales / Mano de obra</th>
              <th>Estado</th>
              <th style="text-align: right;">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% [
                 {
                   name: "Obra Rivera Â· Semana 24",
                   bundles: ["Piso laminado", "2 dÃ­as mano de obra"],
                   status: "Confirmada",
                   tone: "confirmed"
                 },
                 {
                   name: "Retail Centro Â· Pintura",
                   bundles: ["Materiales premium", "Media jornada mano de obra"],
                   status: "Requiere confirmaciÃ³n",
                   tone: "pending"
                 },
                 {
                   name: "Torre Sur Â· ClimatizaciÃ³n",
                   bundles: ["HVAC completo", "3 dÃ­as mano de obra"],
                   status: "En curso",
                   tone: "in-progress"
                 }
               ].each do |booking| %>
              <tr>
                <td>
                  <strong><%= booking[:name] %></strong>
                </td>
                <td>
                  <ul class="stacked-list">
                    <% booking[:bundles].each do |item| %>
                      <li>â€¢ <%= item %></li>
                    <% end %>
                  </ul>
                </td>
                <td>
                  <span class="badge-status <%= booking[:tone] %>"><%= booking[:status] %></span>
                </td>
                <td>
                  <div class="reservation-actions">
                    <button class="button ghost" style="padding: 0.35rem 0.9rem;">Cancelar</button>
                    <button class="button secondary" style="padding: 0.35rem 0.9rem;">Reprogramar</button>
                    <button class="button primary" style="padding: 0.35rem 0.9rem;">Modificar</button>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</section>  